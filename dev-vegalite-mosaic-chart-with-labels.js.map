{"version":3,"file":"dev-vegalite-mosaic-chart-with-labels.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/dev-vegalite-mosaic-chart-with-labels/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\n\nexport default function devVegaliteMosaicChartWithLabels(\n  stanza /* , params */\n) {\n  //let spec = await fetch(params[\"src-url\"]).then((res) => res.json());\n  const spec = JSON.parse(`{\n    \"$schema\": \"https://vega.github.io/schema/vega-lite/v4.json\",\n    \"data\": {\n      \"url\": \"https://vega.github.io/vega-lite/data/cars.json\"\n    },\n    \"transform\": [\n      {\n        \"aggregate\": [\n          {\n            \"op\": \"count\",\n            \"as\": \"count_*\"\n          }\n        ],\n        \"groupby\": [\n          \"Origin\",\n          \"Cylinders\"\n        ]\n      },\n      {\n        \"stack\": \"count_*\",\n        \"groupby\": [],\n        \"as\": [\n          \"stack_count_Origin1\",\n          \"stack_count_Origin2\"\n        ],\n        \"offset\": \"normalize\",\n        \"sort\": [\n          {\n            \"field\": \"Origin\",\n            \"order\": \"ascending\"\n          }\n        ]\n      },\n      {\n        \"window\": [\n          {\n            \"op\": \"min\",\n            \"field\": \"stack_count_Origin1\",\n            \"as\": \"x\"\n          },\n          {\n            \"op\": \"max\",\n            \"field\": \"stack_count_Origin2\",\n            \"as\": \"x2\"\n          },\n          {\n            \"op\": \"dense_rank\",\n            \"as\": \"rank_Cylinders\"\n          },\n          {\n            \"op\": \"distinct\",\n            \"field\": \"Cylinders\",\n            \"as\": \"distinct_Cylinders\"\n          }\n        ],\n        \"groupby\": [\n          \"Origin\"\n        ],\n        \"frame\": [\n          null,\n          null\n        ],\n        \"sort\": [\n          {\n            \"field\": \"Cylinders\",\n            \"order\": \"ascending\"\n          }\n        ]\n      },\n      {\n        \"window\": [\n          {\n            \"op\": \"dense_rank\",\n            \"as\": \"rank_Origin\"\n          }\n        ],\n        \"frame\": [\n          null,\n          null\n        ],\n        \"sort\": [\n          {\n            \"field\": \"Origin\",\n            \"order\": \"ascending\"\n          }\n        ]\n      },\n      {\n        \"stack\": \"count_*\",\n        \"groupby\": [\n          \"Origin\"\n        ],\n        \"as\": [\n          \"y\",\n          \"y2\"\n        ],\n        \"offset\": \"normalize\",\n        \"sort\": [\n          {\n            \"field\": \"Cylinders\",\n            \"order\": \"ascending\"\n          }\n        ]\n      },\n      {\n        \"calculate\": \"datum.y + (datum.rank_Cylinders - 1) * datum.distinct_Cylinders * 0.01 / 3\",\n        \"as\": \"ny\"\n      },\n      {\n        \"calculate\": \"datum.y2 + (datum.rank_Cylinders - 1) * datum.distinct_Cylinders * 0.01 / 3\",\n        \"as\": \"ny2\"\n      },\n      {\n        \"calculate\": \"datum.x + (datum.rank_Origin - 1) * 0.01\",\n        \"as\": \"nx\"\n      },\n      {\n        \"calculate\": \"datum.x2 + (datum.rank_Origin - 1) * 0.01\",\n        \"as\": \"nx2\"\n      },\n      {\n        \"calculate\": \"(datum.nx+datum.nx2)/2\",\n        \"as\": \"xc\"\n      },\n      {\n        \"calculate\": \"(datum.ny+datum.ny2)/2\",\n        \"as\": \"yc\"\n      }\n    ],\n    \"vconcat\": [\n      {\n        \"mark\": {\n          \"type\": \"text\",\n          \"baseline\": \"middle\",\n          \"align\": \"center\"\n        },\n        \"encoding\": {\n          \"x\": {\n            \"aggregate\": \"min\",\n            \"field\": \"xc\",\n            \"title\": \"Origin\",\n            \"axis\": {\n              \"orient\": \"top\"\n            }\n          },\n          \"color\": {\n            \"field\": \"Origin\",\n            \"legend\": null\n          },\n          \"text\": {\"field\": \"Origin\"}\n        }\n      },\n      {\n        \"layer\": [\n          {\n            \"mark\": {\n              \"type\": \"rect\"\n            },\n            \"encoding\": {\n              \"x\": {\n                \"field\": \"nx\",\n                \"type\": \"quantitative\",\n                \"axis\": null\n              },\n              \"x2\": {\"field\": \"nx2\"},\n              \"y\": {\n                \"field\": \"ny\",\n                \"type\": \"quantitative\"\n              },\n              \"y2\": {\"field\": \"ny2\"},\n              \"color\": {\n                \"field\": \"Origin\",\n                \"type\": \"nominal\",\n                \"legend\": null\n              },\n              \"opacity\": {\n                \"field\": \"Cylinders\",\n                \"type\": \"quantitative\",\n                \"legend\": null\n              },\n              \"tooltip\": [\n                {\n                  \"field\": \"Origin\",\n                  \"type\": \"nominal\"\n                },\n                {\n                  \"field\": \"Cylinders\",\n                  \"type\": \"quantitative\"\n                }\n              ]\n            }\n          },\n          {\n            \"mark\": {\n              \"type\": \"text\",\n              \"baseline\": \"middle\"\n            },\n            \"encoding\": {\n              \"x\": {\n                \"field\": \"xc\",\n                \"type\": \"quantitative\",\n                \"axis\": null\n              },\n              \"y\": {\n                \"field\": \"yc\",\n                \"type\": \"quantitative\",\n                \"axis\": {\n                  \"title\": \"Cylinders\"\n                }\n              },\n              \"text\": {\n                \"field\": \"Cylinders\",\n                \"type\": \"nominal\"\n              }\n            }\n          }\n        ]\n      }\n    ],\n    \"resolve\": {\n      \"scale\": {\n        \"x\": \"shared\"\n      }\n    },\n    \"config\": {\n      \"view\": {\n        \"stroke\": \"\"\n      },\n      \"concat\": {\"spacing\": 10},\n      \"axis\": {\n        \"domain\": false,\n        \"ticks\": false,\n        \"labels\": false,\n        \"grid\": false\n      }\n    }\n  }`);\n\n  console.log(spec);\n\n  // 新たにカラースキームを自作したいが、反映されない\n  // vega.scheme('basic', ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff']);\n\n  //カラースキームのセットをパラメータ化して、選択できるようにしたいがvar(--color-scheme)が認識されない・・・\n  // spec.encoding.color.scale = {\"scheme\": \"var(--color-scheme)\"}\n  // spec.encoding.color.scale = {\"scheme\": \"pastel1\"}\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\",\n  };\n  vegaEmbed(el, spec, opts);\n}\n"],"names":["vegaEmbed"],"mappings":";;;;;;AAEe,SAAS,gCAAgC;AACxD,EAAE,MAAM;AACR,EAAE;AACF;AACA,EAAE,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,CAAC,CAAC,CAAC;AACN;AACA,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AAC/C,EAAE,MAAM,IAAI,GAAG;AACf,IAAI,QAAQ,EAAE,KAAK;AACnB,GAAG,CAAC;AACJ,EAAEA,KAAS,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}